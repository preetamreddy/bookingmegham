<% if session[:guest_id] %>
	<h1>Listing Trips for <%= Guest.find(session[:guest_id]).name %></h1>
<% else %>
	<% if params[:payment_status] %>
		<h1>Listing <%= params[:payment_status] %> Trips</h1>
	<% elsif params[:payment_overdue] %>
		<h1>Listing Trips with payment overdue</h1>
	<% else %>
		<h1>Listing all Trips</h1>
	<% end %>
<% end %>

<% if !session[:guest_id] %>
	<div class="action_container">
		Show <%= link_to 'Not Paid Trips', 
								trips_path(:payment_status => Trip::NOT_PAID) %>
		<%= link_to 'Partially Paid Trips', 
					trips_path(:payment_status => Trip::PARTIALLY_PAID) %> 
		<%= link_to 'Trips with payment overdue', 
					trips_path(:payment_overdue => 1) %>
		<%= link_to 'All trips', trips_path %>
	</div>
<% end %>

<% if @records_returned == 0 %>
	<div id="error_explanation">
		<h2>Trips not found</h2>
		<ul>
			<li>Change your search or click below to create a new trip</li>
		</ul>
	</div>
<% else %>
	<% if notice %>
		<p id="error"><%= notice %></p>
	<% end %>

	<table class="index_table" border="1">
	  <tr>
	    <th class="number">ID</th>
	    <th class="text">Guest</th>
	    <th class="text">Trip</th>
	    <th class="text">Rooms</th>
			<th class="number">Payment status</th>
	    <th class="text">Advisor</th>
	    <th></th>
	  </tr>
	
		<% @trips.each do |trip| %>
			<tr class="<%= cycle('list_line_odd', 'list_line_even') %>">
				<td class="number">
					<%= trip.id %>
				</td>
	    	<td class="text">
					<%= trip.guest.name %><br/>
					<%= trip.guest.phone_number %>
				</td>
		    <td class="text">
					<%= trip.name %><br/>
		    	<%= l trip.start_date %> to <%= l trip.end_date %><br/>
					(<%= trip.number_of_days %> days)
				</td>
		    <td class="text">
					<% trip.rooms.each do |room| %>
						<%= pluralize(room.number_of_rooms, room.occupancy) %> @ 
						<%= room.number_of_adults %>
						<%= (" + " + room.number_of_children_between_5_and_12_years.to_s) if room.number_of_children_between_5_and_12_years != 0 %> / room<br/>
					<% end %>
					<% if trip.number_of_children_below_5_years != 0 %>
						Children below 5: <%= trip.number_of_children_below_5_years %><br/>
					<% end %>
					<% if trip.number_of_drivers != 0 %>
						Drivers: <%= trip.number_of_drivers %>
					<% end %>
				</td>
		    <td class="number">
					<%= trip.payment_status %><br/>
					To pay: <%= number_to_currency(trip.final_price) %><br/>
					Paid: <%= number_to_currency(trip.paid) %><br/>
					Balance: <%= number_to_currency(trip.balance_payment) %><br/>
					<% if trip.payment_status != Trip::FULLY_PAID %>
						Pay by: <%= l trip.pay_by_date if trip.pay_by_date %>
					<% end %>
				</td>
	    	<td class="text">
					<%= trip.advisor.name %><br/>
					for <%= trip.agency.name %>
				</td>
	
		    <td>
					<%= link_to 'Show details', trip %></br>
					<%= link_to 'Edit', edit_trip_path(trip) %></br>
		    	<%= link_to 'Destroy', trip, confirm: 'Are you sure?', 
								method: :delete %></br>
					<%= link_to 'View Bookings', 
								bookings_path(:trip_id => trip.id) %></br>
					<%= link_to 'Transport Details', taxi_bookings_path(:trip_id => trip.id) %>
				</td>
		  </tr>
		<% end %>
	</table>
<% end %>

<div class="action_container">
	<%= link_to 'New Trip', new_trip_path %>
</div>
<p><%= will_paginate @trips %></p>
